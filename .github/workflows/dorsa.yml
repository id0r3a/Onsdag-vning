# .github/workflows/deploy.yml
name: Deploy

on:
  workflow_dispatch:
    inputs:
      env:
        description: "Environment to deploy to"
        required: true
        default: dev
        type: choice
        options: [dev, prod]

jobs:
  deploy:
    runs-on: ubuntu-latest

    # DETTA ÄR NYCKELN: bind job till valt environment
    environment:
      name: ${{ inputs.env }}

    steps:
      - name: Print target environment
        run: echo "deploy to ${{ github.environment }}"

      # Kör bara i dev, där vi lade secret
      - name: Echo masked secret (dev only)
        if: ${{ github.environment == 'dev' }}
        run: echo "MY_API_KEY (masked):${{ secrets.MY_API_KEY }}"

      - name: Use secret in a command (dev only)
        if: ${{ github.environment == 'dev' }}
        run: curl -H "Authorization: Bearer ${{ secrets.MY_API_KEY }}" https://example.com/ping || true
